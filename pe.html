<html>

<head>
<style>
select option[disabled] {
    display: none;
}
button {
    background-color: black;
    color: white;
    border-radius: 4px;
}
body{
	background-color: black;
	color: white;
	font-family: arial;
}
input[type=text] {
    background-color: black;
    color: white;
    border: 2px solid white;
    border-radius: 4px;	
    padding: 3px;
    margin-left: 3px;
}
input[type=number] {
    background-color: black;
    color: white;
    border: 2px solid white;
    border-radius: 4px;	
    padding: 1px;
    margin-left: 1px;
    width: 50px;
}
select{
	border: 2px solid white;
	background-color: black;
	color: white;
	width: 70px;
}
#teacherlistarea,#venuelistarea,#sportslistarea,#teachingplanlistarea{
	width: 50%;
	border: 4px solid white;
	padding: 6px;
	border-radius: 4px;
}
#timetable{
	border: 4px solid white;
	padding: 40px;
	width: 60%;
}
th{
	height: 70px;
	padding: 10px;
	border: 4px solid white;
}
</style>
</head>

<body>
<div id="all">
<div id="datainput">
Teacher:
<input onkeyup="checkkey(event,'teacher')" type="text" id="teacherinput"> </input>
<button id='teacheradd' onclick="add('teacher')" >add</button>
<br><br>

Venue:
<input onkeyup="checkkey(event,'venue')" type="text" id="venueinput"> </input>
<button id='venueadd' onclick="add('venue')" >add</button>
<br><br>

Sports:
<input onkeyup="checkkey(event,'sports')" type="text" id="sportsinput"> </input>
<button id='sportsadd' onclick="add('sports')" >add</button>
<br><br>

Teaching plan:
<select onclick="showpage('teachingplan')" id="teacherchoose"></select>
<select onclick="showpage('teachingplan')" id="venuechoose"></select>
<select onclick="showpage('teachingplan')" id="sportschoose"></select>
<select onclick="showpage('teachingplan')" id="genderchoose"><option>Male</option><option>Female</option></select>
<input type="number" onclick="showpage('teachingplan')" id="quantitychoose" value="1"> </input>
<button id='teachingplanadd' onclick="add('teachingplan')">add</button>
<br><br>
<br><br>

<button onclick='showpage("teacher")'>Teacher List</button>
<button onclick='showpage("venue")'>Venue List</button>
<button onclick='showpage("sports")'>Sports list</button>
<button onclick='showpage("teachingplan")'>Teaching Plan List</button>
<br><br>

<div hidden=true id='teacherlistarea'>
<h3>List of teachers:</h3>
<table style="width:70%" id="teacherlist"></table>
<br>
</div>


<div hidden=true id='venuelistarea'>
<h3>List of venues:</h3>
<table style="width:70%" id="venuelist"></table>
<br>
</div>


<div hidden=true id='sportslistarea'>
<h3>List of sports:</h3>
<table style="width:70%" id="sportslist"></table>
<br>
</div>

<div hidden=true id='teachingplanlistarea'>
<h3>List of teaching plans:</h3>
<table style="width:90%" id="teachingplanlist"></table>
<br>
</div>
<br><br>
<button onclick="savepage()" style="padding: 20px; border-radius: 50px;">Save Data</button>
<button onclick="showsaveddata()" style="padding: 20px; border-radius: 50px;">Show Saved Data</button>
<!-- <button onclick="showsaveddata2()" style="padding: 20px; border-radius: 50px;">Show Progress</button> -->
<button onclick="cleardata()" style="padding: 20px; border-radius: 50px;">Clear all Data</button>
<button onclick="nextpage()" style="padding: 20px; border-radius: 50px;">Done</button>
<br><br>
<button onclick="downloaddata()" style="padding: 20px; border-radius: 50px;">Export Data</button>
<button onclick="readTextFile()" style="padding: 20px; border-radius: 50px;">Import Data</button>
</div>

<div id="startchoosing" hidden=true>
Choose the venue: <select onchange="changetableheader(this)" id="choosevenuepage"></select>
<br><br>
<h1 id="tableheader"></h1>
<div id="timetablearea"></div>
<br><br>
<button onclick="nextpage()" style="padding: 20px; border-radius: 50px;">Back</button>
<!-- <button onclick="savepage2()" style="padding: 20px; border-radius: 50px;">Save Progress</button> -->
<button onclick="showdata()" style="padding: 20px; border-radius: 50px;">Search</button>
<button onclick="confirmtimetable()" style="padding: 20px; border-radius: 50px;">Sort by Teachers</button>	
<button onclick="generate()" style="padding: 20px; border-radius: 50px;">Generate Time Table</button>	
<div id="showdataarea"></div>
</div>
<div hidden=true id="showfinaldata">
<select onchange="teacherchoosechange(this)" id="teacherchoose2"></select><br><br>
<div id="showteachertimetablearea"></div><br><br>
<button onclick="confirmtimetable('back')" style="padding: 20px; border-radius: 50px;">Back</button>
<button onclick="showdata()" style="padding: 20px; border-radius: 50px;">Search</button>
</div>
<div id="debug"></div>
<input type="file" hidden="true" id="fileinput" onchange="importdata(this)">
</div>
<script>
var colorlist = [];
colorlist[0] = "black";
colorlist[1] = "blue";
colorlist[2] = "red";
colorlist[3] = "BlueViolet";
colorlist[4] = "Gold";
colorlist[5] = "brown";
colorlist[6] = "Chartreuse";
colorlist[7] = "DarkCyan";
colorlist[8] = "DarkGoldenRod";
colorlist[9] = "DarkGray";
colorlist[10] = "DarkTurquoise";
colorlist[11] = "BlanchedAlmond";
colorlist[12] = "DarkSalmon";
colorlist[13] = "DeepPink";
colorlist[14] = "DarkSlateBlue";
colorlist[15] = "Green";
colorlist[16] = "GreenYellow";
colorlist[17] = "LightBlue";
colorlist[18] = "LightCoral";
colorlist[19] = "LightSkyBlue";
colorlist[20] = "LightSeaGreen";
colorlist[21] = "LightSalmon";
colorlist[22] = "LightSkyBlue";
colorlist[23] = "OrangeRed";
colorlist[24] = "Thistle";
colorlist[25] = "WhiteSmoke";
colorlist[26] = "black";
colorlist[27] = "black";
colorlist[28] = "black";
colorlist[29] = "black";
colorlist[30] = "black";

var orderlistx = [];
orderlistx[1] = 1;
orderlistx[2] = 2;
orderlistx[3] = 3;
orderlistx[4] = 4;
orderlistx[5] = 5;
orderlistx[6] = 6;
orderlistx[7] = 7;
orderlistx[8] = 8;
orderlistx[9] = 9;

var orderlisty = [];
orderlisty[2] = 2;
orderlisty[3] = 6;
orderlisty[4] = 3;
orderlisty[5] = 4;
orderlisty[6] = 5;
orderlisty[7] = 7;
// orderlisty[8] = 8;

var tablexlength = 8;
var tableylength = 6;

var optionlist = [];

var generatedone = 0;
function dfs(t,c,x,y,n){
	// alert(x+' '+y+' '+n);
	if (t.rows[x].cells[y].childNodes[1].innerHTML=="x"&&t.rows[x].cells[y].childNodes[0].options[n].disabled==false){
		t.rows[x].cells[y].childNodes[0].options[n].selected = true;
		t.rows[x].cells[y].style.backgroundColor = colorlist[n];
		generatedone++;
		teachingplanct[c][n]++;
	}
	
	if (generatedone<(t.rows[1].cells[2].childNodes[0].length-1)*2){
		// for (var j=1; j<t.rows.length; j++){
		// 	for (var k=2; k<t.rows[j].cells.length; k++){
		for (var k=2; k<=tableylength; k++){
			for (var j=1; j<=tablexlength; j++){
				// alert(t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[1].innerHTML);
				if (t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[1].innerHTML=='x'&&t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[0].selectedIndex==0){
					for (var jj=1; jj<t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[0].length; jj++){
						var maxtogether = 0;
						var together = 1;
						var cellteacher = t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[0].options[optionlist[jj]].text.substring(0,t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[0].options[optionlist[jj]].text.indexOf(' '));
						for (var kk=2; kk<tablexlength; kk++){
							var upnode = t.rows[kk-1].cells[orderlisty[k]].childNodes[0];
							var downnode = t.rows[kk].cells[orderlisty[k]].childNodes[0];
							var uptext = upnode.options[upnode.selectedIndex].text;
							var downtext = downnode.options[downnode.selectedIndex].text;
							if (kk==orderlistx[j]){
								if ((upnode.options[jj].disabled==true || uptext.substring(0,uptext.indexOf(' '))==cellteacher) && t.rows[kk-1].cells[orderlisty[k]].childNodes[1].innerHTML=='x'){
									together++;
								} else {
									together = 1;
								}
							} else {
								if ((upnode.options[jj].disabled==true || uptext.substring(0,uptext.indexOf(' '))==cellteacher) && (downnode.options[jj].disabled==true || downtext.substring(0,downtext.indexOf(' '))==cellteacher) && t.rows[kk].cells[orderlisty[k]].childNodes[1].innerHTML=='x'&&t.rows[kk-1].cells[orderlisty[k]].childNodes[1].innerHTML=='x'){
									together++;
								} else {
									together = 1;
								}
							}
							if (together>maxtogether)
								maxtogether = together;
						}
						if (maxtogether<=3){
							var checkcell,checkcell2,check1,check2;
							if (t.id=="SPtable"&&orderlistx[j]==2){
								checkcell = t.rows[1].cells[orderlisty[k]].childNodes[0];
								checkcell2 = t.rows[2].cells[orderlisty[k]].childNodes[0];
								check1 = checkcell.options[checkcell.selectedIndex].text.substring(0,checkcell.options[checkcell.selectedIndex].text.indexOf(' '));
								check2 = checkcell2.options[optionlist[jj]].text.substring(0,checkcell2.options[optionlist[jj]].text.indexOf(' '));
							}
							if (!(t.id=="SPtable"&&orderlistx[j]==2&&check1==check2)){
								if (t.rows[orderlistx[j]].cells[orderlisty[k]].childNodes[0].options[optionlist[jj]].disabled==false&&teachingplanct[c][optionlist[jj]]<2){
									var singlelesson = false;
									if ((teachingplanct[c][optionlist[jj]]==1&&orderlistx[j]>1&&t.rows[orderlistx[j]-1].cells[orderlisty[k]].childNodes[0].selectedIndex!=optionlist[jj])||t.id=="SPtable"&&orderlistx[j]>1){
										for (var kk=1; kk<=tablexlength; kk++)
											if (kk!=orderlistx[j]&&t.rows[kk].cells[orderlisty[k]].childNodes[0].selectedIndex==optionlist[jj]){
												singlelesson = true;
												break;
											}
											// alert(singlelesson);
											if (singlelesson==false){
												dfs(t,c,orderlistx[j],orderlisty[k],optionlist[jj]);
											}
									} else {
										dfs(t,c,orderlistx[j],orderlisty[k],optionlist[jj]);
									}							
								}
							}
						}
					}
				}
			}
		}
		if (generatedone==(t.rows[1].cells[2].childNodes[0].length-1)*2){
			return;
		}
		if (t.rows[x].cells[y].childNodes[1].innerHTML=="x"&&t.rows[x].cells[y].childNodes[0].options[n].disabled==false){
			teachingplanct[c][n]--;
			generatedone--;
			t.rows[x].cells[y].style.backgroundColor = "black";
			t.rows[x].cells[y].childNodes[0].options[0].selected = true;
		}
	} else {
		return;
	}
	
}

function findgender(x){
	var table = document.getElementById("teachingplanlist");
	for (var j=0; j<table.rows.length; j++){
		if (table.rows[j].cells[5].innerHTML == x){
			return table.rows[j].cells[4].innerHTML;
		}
	}
}

function generate(){
	var table = document.getElementById(document.getElementById("choosevenuepage").options[document.getElementById("choosevenuepage").selectedIndex].text+'table');
	var pass = true;
	for (var j=1; j<table.rows.length; j++){
		for (var k=2; k<table.rows[j].cells.length; k++){
			if (table.rows[j].cells[k].childNodes[0].selectedIndex!=0){
				pass = false;
				break;
			}
		}
	}
	if (pass == false){
		alert("Please cancel all selected options in the table first.");
	} else {
		generatedone = 0;
		var tempselect = table.rows[1].cells[2].childNodes[0];
		var templist = [];
		var genderorder='Male';
		var divnum=1;
		// if (table.id=="SPtable"){
		// 	divnum = 3;
		// } else {
		// 	divnum = 4;
		// }
		if (parseInt(j/divnum)%2==0){
			genderorder = 'Male';
		} else {
			genderorder = 'Female';
		}
		for (var j=0; j<tempselect.length; j++){
			templist[j] = tempselect.options[j].text.substring(0,tempselect.options[j].text.indexOf(" "));
			optionlist[j] = j;
		}
		for (var j=1; j<tempselect.length-1; j++){
			var different = j+1;
			var cannotfind = true;
			while (templist[j]==templist[different]&&findgender(templist[j])!=genderorder&&different<tempselect.length-1){
				if (templist[j]==templist[different]&&findgender(templist[j])!=genderorder)
					cannotfind = false;
				different++;
			}
			if (cannotfind){
				different = j+1;
				while (templist[j]==templist[different]&&different<tempselect.length-1){
					different++;
				}
			}
			var tempswap = templist[j+1];
			templist[j+1] = templist[different];
			templist[different] = tempswap;
			var tempswap2 = optionlist[j+1];
			optionlist[j+1] = optionlist[different];
			optionlist[different] = tempswap2;
		}
		var startoption = 1;
		while (generatedone<(table.rows[1].cells[2].childNodes[0].length-1)*2 && startoption<table.rows[1].cells[2].childNodes[0].length){
			dfs(table,document.getElementById("choosevenuepage").selectedIndex,1,2,startoption);
			startoption++;
		}
		if (generatedone==(table.rows[1].cells[2].childNodes[0].length-1)*2){
			//check
			for (var j=1; j<table.rows.length; j++){
				for (var k=2; k<table.rows[j].cells.length; k++){
					for (var jj=1; jj<table.rows[j].cells[k].childNodes[0].length; jj++)
					table.rows[j].cells[k].childNodes[0].options[jj].disabled = true;
				}
			}
			for (var j=1; j<table.rows.length; j++){
				for (var k=2; k<table.rows[j].cells.length; k++){
					if (table.rows[j].cells[k].childNodes[0].selectedIndex>0){
						var x = table.rows[j].cells[k].childNodes[0];
						var timeofcell = table.rows[j].cells[1].innerHTML;
						var dayofcell = k-2;
						var temptable = document.getElementById(x.options[x.selectedIndex].text.substring(0,x.options[x.selectedIndex].text.indexOf(" "))+"timetable");
						var coursecode = x.options[x.selectedIndex].text.substring(x.options[x.selectedIndex].text.indexOf(" ")+1, x.options[x.selectedIndex].text.length);
						// alert(x.options[x.selectedIndex].text.substring(0,x.options[x.selectedIndex].text.indexOf(" ")));
						var endpoint = 1;
						while (temptable.rows[endpoint].cells[dayofcell].innerHTML!='+')
							endpoint++;
						// alert(endpoint);
						temptable.rows[endpoint].cells[dayofcell].innerHTML = timeofcell+' '+coursecode;
						temptable.rows[endpoint+1].cells[dayofcell].innerHTML = "+";
						for (var jj=0; jj<=dayofcell; jj++)
							temptable.rows[endpoint+1].cells[jj].style.display = "";
						temptable.rows[endpoint+1].cells[dayofcell].style.border = '4px solid #FFFFFF';
						sorttable(temptable.rows[endpoint].cells[dayofcell],temptable);
					}
				}
			}
			alert('Done!');
		} else {
			alert("There is no solution, please swap the previous timetable.");
		}
	}
}
function showsaveddata(){
	if (typeof(Storage)!=="undefined"){
		if (localStorage.getItem("mypage")!=null&&localStorage.getItem("mypage")!=''){
			// document.getElementById("all").innerHTML = localStorage.getItem("mypage");
			document.getElementById("datainput").innerHTML = localStorage.getItem("mypage");
			// alert('Data found');
			//alert(localStorage.getItem("mypage"));
			document.getElementById('choosevenuepage').innerHTML = document.getElementById("venuechoose").innerHTML;
		} else {
			alert('Data not found');
		}
	} else {
		alert('Your broswer does not support this function');
	}
}
function showsaveddata2(){
	if (typeof(Storage)!=="undefined"){
		if (localStorage.getItem("myprogress")!=null&&localStorage.getItem("myprogress")!=''){
			document.getElementById("all").innerHTML = localStorage.getItem("myprogress");
			// document.getElementById("datainput").innerHTML = localStorage.getItem("mypage");
			// alert('Data found');
			//alert(localStorage.getItem("mypage"));
		} else {
			alert('Data not found');
		}
	} else {
		alert('Your broswer does not support this function');
	}
}

function readTextFile(file)
{	
	// document.getElementById("fileinput").click();
	importdata();
}

// function importdata(x){
// 	alert('file:\\\\\\'+x.value);
// 	if (x!=''){
// 		var client = new XMLHttpRequest();
// 		client.open('GET', 'file:///'+x.value);
// 		client.onreadystatechange = function() {
// 		  alert(client.responseText);
// 		}
// 		client.send();
// 	}
	
// }

function importdata(x){
	var pastedata = prompt("Paste the data here.");
	if (pastedata!=null&&pastedata!=''){
		document.getElementById("datainput").innerHTML = pastedata;
		document.getElementById('choosevenuepage').innerHTML = document.getElementById("venuechoose").innerHTML;
	}

}

function downloaddata(){
    var elHtml = document.getElementById("datainput").innerHTML;
    var link = document.createElement('a');
    var mimeType = 'text/plain';
    var filename = 'data.txt';
    link.setAttribute('download', filename);
    link.setAttribute('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elHtml));
    link.click(); 
}

function savepage(){
	if (typeof(Storage)!=="undefined"){
		// localStorage.setItem("mypage",document.getElementById("all").innerHTML);
		localStorage.setItem("mypage",document.getElementById("datainput").innerHTML);
		alert('Saved Successfully');
		//alert(localStorage.getItem("mypage"));
	} else {
		alert('Your broswer does not support this function');
	}
}
function savepage2(){
	if (typeof(Storage)!=="undefined"){
		localStorage.setItem("myprogress",document.getElementById("all").innerHTML);
		// localStorage.setItem("mypage",document.getElementById("datainput").innerHTML);
		alert('Saved Successfully');
		//alert(localStorage.getItem("mypage"));
	} else {
		alert('Your broswer does not support this function');
	}
}
function cleardata(){
	if (typeof(Storage)!=="undefined"){
		if (confirm('Are you sure to clear all data?')){
			localStorage.setItem("mypage",'');
			localStorage.setItem("myprogress",'');
			alert('Cleared Successfully');
		}
	} else {
		alert('Your broswer does not support this function');
	}
}
function confirmtimetable(x){
	if (x=='back'){
		document.getElementById("startchoosing").hidden = false;
		document.getElementById("showfinaldata").hidden = true;
		changetable(document.getElementById("tableheader").innerHTML);
	} else {
		document.getElementById("startchoosing").hidden = true;
		document.getElementById("showfinaldata").hidden = false;
	}
}
function teacherchoosechange(x){
	document.getElementById(x.options[x.selectedIndex].text+"timetable").style.display = "";
	// alert(x.options[x.selectedIndex].text+"timetable");
	for (var j=0; j<document.getElementById("teacherlist").rows.length; j++){
		var tempteachername = document.getElementById("teacherlist").rows[j].cells[1].innerHTML;
		if (tempteachername!=x.options[x.selectedIndex].text)
			document.getElementById(tempteachername+"timetable").style.display = "none";
	}
}
function showdata(){
	var tempshowdata = '';
	var count = 0;
	var searchid = prompt("Please enter the class id / teahcer name / venue / sports name","");
	if (searchid!=null){
		for (var j=0; j<document.getElementById("teachingplanlist").rows.length; j++){
			for (var k=1; k<=5; k++){
				if (document.getElementById("teachingplanlist").rows[j].cells[k].innerHTML==searchid){ // && k<=4){
					count++;
					tempshowdata+=' '+document.getElementById("teachingplanlist").rows[j].cells[0].innerHTML+') '+document.getElementById("teachingplanlist").rows[j].cells[1].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[2].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[3].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[4].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[5].innerHTML; //childNodes[0].value+'\n';//+'<br>';
				} 
				// else if (k==5 && document.getElementById("teachingplanlist").rows[j].cells[5].childNodes[0].value==searchid){
				// 	count++;
				// 	tempshowdata+=' '+document.getElementById("teachingplanlist").rows[j].cells[0].innerHTML+') '+document.getElementById("teachingplanlist").rows[j].cells[1].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[2].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[3].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[4].innerHTML+' '+document.getElementById("teachingplanlist").rows[j].cells[5].innerHTML; //childNodes[0].value+'\n';//+'<br>';
				// }
			}
		}
		if (count==0){
			alert('No data found');
			//document.getElementById("showdataarea").innerHTML = '<br>No data found';
		} else {
			alert(tempshowdata);
			//document.getElementById("showdataarea").innerHTML = '<br>'+tempshowdata;
		}
	}
}
function preset(x,y){
	if (x.innerHTML=="x"){
		if (x.parentNode.childNodes[0].selectedIndex==0){
			x.innerHTML="âœ“";
			x.parentNode.style.backgroundColor = "black";
			x.parentNode.childNodes[0].style.visibility = "hidden";
		} else {
			alert("Please make this time slot blank in order to disable it");
		}
	} else {
		x.innerHTML="x";
		x.parentNode.style.backgroundColor = "black";
		x.parentNode.childNodes[0].style.visibility = "";
	}
}
function findteachingplanid(x){
	for (var j=0; j<document.getElementById('teachingplanlist').rows.length; j++){
		var temp = document.getElementById('teachingplanlist').rows[j];
		//document.getElementById("debug").innerHTML+=x+' , '+temp.cells[1].innerHTML+' '+temp.cells[5].childNodes[0].value+'<br>';
		if (x==temp.cells[1].innerHTML+' '+temp.cells[5].innerHTML){ //childNodes[0].value){
			return j;
		}
	}
}
var oldindex = 0;
function getoldindex(x){
	oldindex = x.selectedIndex;
}
var teachingplanct = [];
for (var j=0; j<500; j++)
	teachingplanct[j]=[];
function checktable(x,y){ 
	var venueindex = document.getElementById('choosevenuepage').selectedIndex;
	var table = x.parentNode.parentNode.parentNode;
	x.parentNode.style.backgroundColor = colorlist[x.selectedIndex];
	//x.options[0].disabled = true;
	// var teachingplanct = [];
	// for (var j=0; j<document.getElementById('teachingplanlist').rows.length+10; j++){
	// 	teachingplanct[j] = 0;
	// }
	// for (var j=1; j<=9; j++){
	// 	for (var k=2; k<=7; k++){
	// 		var tempoption  = table.rows[j].cells[k].childNodes[0];
	// 		var seltext = tempoption.options[tempoption.selectedIndex].text;
	// 		if (tempoption.selectedIndex!=0){
	// 			//seltext = y+' '+seltext;
	// 			//document.getElementById("debug").innerHTML = findteachingplanid(seltext);
	// 			//teachingplanct[findteachingplanid(seltext)]++;
	// 			teachingplanct[tempoption.selectedIndex]++;
	// 		}
	// 	}
	// }
	var dayofcell = x.parentNode.cellIndex-2;
	var timeofcell = table.rows[x.parentNode.parentNode.rowIndex].cells[1].innerHTML;
	if (oldindex>0){
		teachingplanct[venueindex][oldindex]--;
		var temptable = document.getElementById(x.options[oldindex].text.substring(0,x.options[oldindex].text.indexOf(" "))+"timetable");
		var coursecode = x.options[oldindex].text.substring(x.options[oldindex].text.indexOf(" ")+1, x.options[oldindex].text.length);
		var tempj = 1;
		while (temptable.rows[tempj].cells[dayofcell].innerHTML!=timeofcell+' '+coursecode){
			// alert(temptable.rows[tempj].cells[dayofcell].innerHTML+' '+timeofcell+' '+coursecode);
			tempj++;
		}
		var ct = tempj;
		// alert(ct);
		while (temptable.rows[ct+1].cells[dayofcell].innerHTML!=""){
			temptable.rows[ct].cells[dayofcell].innerHTML = temptable.rows[ct+1].cells[dayofcell].innerHTML
			ct++;
		}
		if (ct>1){
			temptable.rows[ct].cells[dayofcell].innerHTML = "";
			// temptable.rows[ct].cells[x.cellIndex].style.display = "none";
			temptable.rows[ct].cells[dayofcell].style.border = "0px";
		}
	}
	
	if (x.selectedIndex>0){
		teachingplanct[venueindex][x.selectedIndex]++;
		var temptable = document.getElementById(x.options[x.selectedIndex].text.substring(0,x.options[x.selectedIndex].text.indexOf(" "))+"timetable");
		var coursecode = x.options[x.selectedIndex].text.substring(x.options[x.selectedIndex].text.indexOf(" ")+1, x.options[x.selectedIndex].text.length);
		// alert(x.options[x.selectedIndex].text.substring(0,x.options[x.selectedIndex].text.indexOf(" ")));
		var endpoint = 1;
		while (temptable.rows[endpoint].cells[dayofcell].innerHTML!='+')
			endpoint++;
		// alert(endpoint);
		temptable.rows[endpoint].cells[dayofcell].innerHTML = timeofcell+' '+coursecode;
		temptable.rows[endpoint+1].cells[dayofcell].innerHTML = "+";
		for (var j=0; j<=dayofcell; j++)
			temptable.rows[endpoint+1].cells[j].style.display = "";
		temptable.rows[endpoint+1].cells[dayofcell].style.border = '4px solid #FFFFFF';
		sorttable(temptable.rows[endpoint].cells[dayofcell],temptable);
	}
	for (var j=1; j<=9; j++){
		var tempchecktime = table.rows[j].cells[1].innerHTML;
		for (var k=2; k<=7; k++){
			var temptime = table.rows[j].cells[1].innerHTML;
			var tempoption = table.rows[j].cells[k].childNodes[0];
			//if (tempoption.selectedIndex==0){
				for (var jj=1; jj<tempoption.options.length; jj++){
					// var tempindex = findteachingplanid(tempoption.options[jj].text);
					// if (teachingplanct[tempindex]>=2){
					var tempteachertable = document.getElementById(tempoption.options[jj].text.substring(0,tempoption.options[jj].text.indexOf(' '))+"timetable");
					var crashed = false;
					for (var kk=1; tempteachertable.rows[kk].cells[k-2].innerHTML!='+'; kk++){
						// alert(tempteachertable.rows[kk].cells[k-2].innerHTML+' '+tempchecktime+' '+comparetime(tempteachertable.rows[kk].cells[k-2].innerHTML,tempchecktime));
						if (comparetime(tempteachertable.rows[kk].cells[k-2].innerHTML,tempchecktime)==2){
							crashed = true;
							break;
						}
					}
					if (teachingplanct[venueindex][jj]>=2||crashed){
						tempoption.options[jj].disabled = true;
					} else {
						tempoption.options[jj].disabled = false;
					}
				}
			//}
		}
	}
	//document.getElementById('debug').innerHTML = teachingplanct;
}
function changetable(x){
	for (var j=0; j<document.getElementById("venuelist").rows.length; j++){
		// alert(document.getElementById(document.getElementById("venuelist").rows[j].cells[1].innerHTML+"table"));
		document.getElementById(document.getElementById("venuelist").rows[j].cells[1].innerHTML+"table").hidden = true;
	}
	document.getElementById(x+"table").hidden=false;
	var table = document.getElementById(x+"table");
	for (var j=1; j<=9; j++){
		var tempchecktime = table.rows[j].cells[1].innerHTML;
		for (var k=2; k<=7; k++){
			var temptime = table.rows[j].cells[1].innerHTML;
			var tempoption = table.rows[j].cells[k].childNodes[0];
			//if (tempoption.selectedIndex==0){
				for (var jj=1; jj<tempoption.options.length; jj++){
					// var tempindex = findteachingplanid(tempoption.options[jj].text);
					// if (teachingplanct[tempindex]>=2){
					var tempteachertable = document.getElementById(tempoption.options[jj].text.substring(0,tempoption.options[jj].text.indexOf(' '))+"timetable");
					var crashed = false;
					for (var kk=1; tempteachertable.rows[kk].cells[k-2].innerHTML!='+'; kk++){
						// alert(tempteachertable.rows[kk].cells[k-2].innerHTML+' '+tempchecktime+' '+comparetime(tempteachertable.rows[kk].cells[k-2].innerHTML,tempchecktime));
						if (comparetime(tempteachertable.rows[kk].cells[k-2].innerHTML,tempchecktime)==2){
							crashed = true;
							break;
						}
					}
					if (crashed||teachingplanct[document.getElementById("choosevenuepage").selectedIndex][jj]>=2){
						tempoption.options[jj].disabled = true;
					} else {
						tempoption.options[jj].disabled = false;
					}
				}
			//}
		}
	}
}
function changetableheader(x){
	document.getElementById("tableheader").innerHTML=x.options[x.selectedIndex].text;
	changetable(document.getElementById("tableheader").innerHTML);
}
function timecount(x){
	if (x<10){
		return '0'+x;
	} else {
		return x;
	}
}
function nextpage(){
	var wrong = false;
	if (document.getElementById('startchoosing').hidden){
		for (var j=0; j<document.getElementById("teachingplanlist").rows.length; j++){
			//alert(typeof(document.getElementById("teachingplanlist").rows[j].cells[5].innerHTML));
			// alert(document.getElementById("teachingplanlist").rows[j].cells[5].innerHTML.substring(0,5));
			if (document.getElementById("teachingplanlist").rows[j].cells[5].innerHTML.substring(0,6)=='<input'){
				wrong = true;
			}
		}
		if (wrong){
			alert('Please confirm all course code.');
		} else if (document.getElementById("teachingplanlist").rows.length==0){
			alert('Not enought information to form a table.');
		} else {
			for (var k=0; k<document.getElementById("venuelist").rows.length+10; k++)
				for (var j=0; j<document.getElementById('teachingplanlist').rows.length+10; j++){
				teachingplanct[k][j] = 0;
			}
			document.getElementById("timetablearea").innerHTML = '';
			document.getElementById("showteachertimetablearea").innerHTML = '';
			var table = '';
			var venuetable = document.getElementById("venuelist");
			for (var j=0; j<venuetable.rows.length; j++){
				var x = venuetable.rows[j].cells[1].innerHTML;
				var teachingplantable = document.getElementById("teachingplanlist");
				//if (!document.getElementById(x+"table")){
					//document.getElementById("timetablearea").innerHTML;
					table += "<table hidden=true id='"+x+"table'><tr><th></th><th>Time Slot</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thur</th><th>Fri</th><th>Sat</th><th>Sun</th></tr>";
					var tempoption = '<option></option>';
					for (var jj=0; jj<teachingplantable.rows.length; jj++){
						if (teachingplantable.rows[jj].cells[2].innerHTML==x){
							var classid = teachingplantable.rows[jj].cells[5].innerHTML; //childNodes[0].value;
							tempoption+='<option>'+teachingplantable.rows[jj].cells[1].innerHTML+'  '+classid+'</option>';
						}
					}
					for (var jj=1; jj<=9; jj++){
						table += '<tr><th>'+jj+'</th><th onclick="changetime(this)">'+timecount(jj+7)+':30-'+timecount(jj+8)+':15</th>';
						for (kk=1; kk<=6; kk++){
							table += '<th><select onclick="getoldindex(this)" onchange="checktable(this,&quot;'+x+'&quot;)" style="width: 100px;" id="'+x+''+jj+''+kk+'">'+tempoption+'</select><button onclick="preset(this,&quot;'+x+'&quot;)">x</button></th>';
						}
						table += '</tr>';
					}
					table+='</table>';
				//}
			}
			document.getElementById("teacherchoose2").innerHTML=document.getElementById("teacherchoose").innerHTML;
			for (var j=0; j<document.getElementById("teacherlist").rows.length; j++){
				var tempid = document.getElementById("teacherlist").rows[j].cells[1].innerHTML+'timetable';
				var tempinnerhtml = '<table style="display:none" id="'+tempid+'"><tbody><tr><th onclick="addtime(this)">Mon</th><th onclick="addtime(this)">Tue</th><th onclick="addtime(this)">Wed</th><th onclick="addtime(this)">Thur</th><th onclick="addtime(this)">Fri</th><th onclick="addtime(this)">Sat</th><th onclick="addtime(this)">Sun</th></tr><tr><th onclick="addtime(this)">+</th><th onclick="addtime(this)">+</th><th onclick="addtime(this)">+</th><th onclick="addtime(this)">+</th><th onclick="addtime(this)">+</th><th onclick="addtime(this)">+</th></tr>';
				for (var k=0; k<30; k++){
					tempinnerhtml += '<tr><th style="display: none; border: 0px" onclick="addtime(this)"></th><th style="display: none; border: 0px" onclick="addtime(this)"></th><th style="display: none; border: 0px" onclick="addtime(this)"></th><th style="display: none; border: 0px" onclick="addtime(this)"></th><th style="display: none; border: 0px" onclick="addtime(this)"></th><th style="display: none; border: 0px" onclick="addtime(this)"></th></tr>';
				}
				tempinnerhtml += '</tbody></table>';
				document.getElementById("showteachertimetablearea").innerHTML += tempinnerhtml;
				// prompt("hi",document.getElementById("showteachertimetablearea").innerHTML);
			}
			document.getElementById("timetablearea").innerHTML = table;
			document.getElementById('datainput').hidden=!document.getElementById('datainput').hidden;
			document.getElementById('startchoosing').hidden=!document.getElementById('startchoosing').hidden;
			if (document.getElementById("SPtable")){
				var sptable = document.getElementById("SPtable");
				sptable.rows[1].cells[1].innerHTML = '09:00-10:09';
				sptable.rows[2].cells[1].innerHTML = '09:00-10:09';
				sptable.rows[3].cells[1].innerHTML = '10:10-11:20';
				sptable.rows[4].cells[1].innerHTML = '11:30-12:39';
				sptable.rows[5].cells[1].innerHTML = '12:40-13:49';
				sptable.rows[6].cells[1].innerHTML = '13:50-14:59';
				sptable.rows[7].cells[1].innerHTML = '15:00-16:10';
				// sptable.rows[7].style.display = "none";
				sptable.rows[8].style.display = "none";
				sptable.rows[9].style.display = "none";
				for (var j=8; j<=9; j++){
					for (var k=2; k<=7; k++){
						sptable.rows[j].cells[k].childNodes[1].click();
					}
				}
			}
			changetableheader(document.getElementById("choosevenuepage"));
			teacherchoosechange(document.getElementById("teacherchoose2"));
		}	
	} else {
		if (confirm('Warning! What you did in this page will not be saved anymore.')){
			document.getElementById('datainput').hidden=!document.getElementById('datainput').hidden;
			document.getElementById('startchoosing').hidden=!document.getElementById('startchoosing').hidden;
		}
	}
}

function changetime(x){
	var asktime = prompt("Please enter the time you want to change to.","xx:xx-xx:xx");
	if (asktime!=null&&asktime!=''){
		if (asktime[2]==':'&&asktime[8]==':'&&asktime[5]=='-'){
			x.innerHTML = asktime;
		} else {
			alert('Wrong Format.');
		}
	}
}

function comparetime(x,y){
	var tempfromhour = parseInt(x[0]*10+x[1]);
	var tempfromminute = parseInt(x[3]*10+x[4]);
	var temptohour = parseInt(x[6]*10+x[7]);
	var temptominute = parseInt(x[9]*10+x[10]);
	var tempfromhour2 = parseInt(y[0]*10+y[1]);
	var tempfromminute2 = parseInt(y[3]*10+y[4]);
	var temptohour2 = parseInt(y[6]*10+y[7]);
	var temptominute2 = parseInt(y[9]*10+y[10]);
	if (temptohour<tempfromhour2||temptohour==tempfromhour2&&temptominute<tempfromminute2){
		return 0;
	} else if (tempfromhour>temptohour2||tempfromhour==temptohour2&&tempfromminute>temptominute2){
		return 1;
	} else {
		return 2;
	}
	// if < return 0, > return 1, intercepted return 2
}
function sorttable(x,y){
	var sortrownum = x.cellIndex;
	for (var j=1; j<=x.parentNode.rowIndex-1; j++){
		for (var k=j+1; k<=x.parentNode.rowIndex; k++){
			// alert(y.rows[j].cells[sortrownum].innerHTML+' '+y.rows[k].cells[sortrownum].innerHTML+' '+comparetime(y.rows[j].cells[sortrownum].innerHTML,y.rows[k].cells[sortrownum].innerHTML));
			if (comparetime(y.rows[j].cells[sortrownum].innerHTML,y.rows[k].cells[sortrownum].innerHTML)==1){
				// alert(j+' '+k);
				var tempcell = y.rows[j].cells[sortrownum].innerHTML;
				y.rows[j].cells[sortrownum].innerHTML = y.rows[k].cells[sortrownum].innerHTML;
				y.rows[k].cells[sortrownum].innerHTML = tempcell;
			}
		}
	}
}
function addtime(x){
	var answer = prompt("Please input the time that are occupied","xx:xx-xx:xx");
	if (answer!=null){
		var temptable = x.parentNode.parentNode;
		if (answer==""){
			var ct = x.parentNode.rowIndex;
			while (temptable.rows[ct+1].cells[x.cellIndex].innerHTML!=""){
				temptable.rows[ct].cells[x.cellIndex].innerHTML = temptable.rows[ct+1].cells[x.cellIndex].innerHTML
				ct++;
			}
			if (ct>1){
				temptable.rows[ct].cells[x.cellIndex].innerHTML = "";
				// temptable.rows[ct].cells[x.cellIndex].style.display = "none";
				temptable.rows[ct].cells[x.cellIndex].style.border = "0px";
			}
		}
		else if (answer[2]==':'&&answer[8]==':'&&answer[5]=='-'){
			temptable.rows[x.parentNode.rowIndex].cells[x.cellIndex].innerHTML = answer+' NA';
			if (temptable.rows[x.parentNode.rowIndex+1].cells[x.cellIndex].innerHTML == '')
				temptable.rows[x.parentNode.rowIndex+1].cells[x.cellIndex].innerHTML = '+';
			for (var j=0; j<=x.cellIndex; j++)
				temptable.rows[x.parentNode.rowIndex+1].cells[j].style.display = "";
			temptable.rows[x.parentNode.rowIndex+1].cells[x.cellIndex].style.border = '4px solid #FFFFFF';//'4px solid white';//cells[x.cellIndex].style.display = '';
			sorttable(x,temptable);
		} else {
			alert('Wrong format!');
		}
	}
}
function refreashdroplist(x){
	document.getElementById(x+"choose").options.length=0;
	for (var j=0; j<document.getElementById(x+"list").rows.length; j++){
		var temp = document.createElement("option");
		temp.text = document.getElementById(x+"list").rows[j].cells[1].innerHTML;
		// alert(document.getElementById(x+"list").rows[j].cells[1].innerHTML);
		document.getElementById(x+"choose").add(temp,document.getElementById(x+"choose")[0]);
	}
	if (x=='venue'){
		document.getElementById('choosevenuepage').innerHTML = document.getElementById("venuechoose").innerHTML;
	}
}
function refresh(x){
	for (var j=0; j<x.rows.length; j++){
		x.rows[j].cells[0].innerHTML = j+1;
	}
}
function add(s){
	// alert(s);
	if (s=='teachingplan'){
		showpage('teachingplan');
		if (document.getElementById("teacherchoose").options.length==0||document.getElementById("venuechoose").options.length==0||document.getElementById("sportschoose").options.length==0){
			alert('empty input');
		} else {
			for (var j=0; j<document.getElementById("quantitychoose").value; j++){
				var table = document.getElementById(s+"list");
				var row = table.insertRow(table.rows.length);
				var cell0 = row.insertCell(0);
				var cell1 = row.insertCell(1);
				var cell2 = row.insertCell(2);
				var cell3 = row.insertCell(3);
				var cell4 = row.insertCell(4);
				var cell5 = row.insertCell(5);
				var cell6 = row.insertCell(6);
				cell1.innerHTML = document.getElementById("teacherchoose").options[document.getElementById("teacherchoose").selectedIndex].text;
				cell2.innerHTML = document.getElementById("venuechoose").options[document.getElementById("venuechoose").selectedIndex].text;
				cell3.innerHTML = document.getElementById("sportschoose").options[document.getElementById("sportschoose").selectedIndex].text;
				cell6.innerHTML = "<button onclick='deletetable(this,&quot;"+s+"&quot;)'>x</button>";
				if (document.getElementById("genderchoose").selectedIndex==0){
					cell4.innerHTML = "Male";
				} else {
					cell4.innerHTML = "Female";
				}
				cell5.innerHTML = "<input onkeyup='checkkey2(event,this)' type='text' style='width:100px' min='1' step='1' value=''></input>";
				refresh(table);
			}
			
		}
		
	} else {
		if (document.getElementById(s+"input").value==''){
			alert('empty input');
		} else {
			var table = document.getElementById(s+"list");
			var row = table.insertRow(table.rows.length);
			var cell0 = row.insertCell(0);
			var cell1 = row.insertCell(1);
			var cell2 = row.insertCell(2);
			cell1.innerHTML = document.getElementById(s+"input").value;
			cell2.innerHTML = "<button onclick='deletetable(this,&quot;"+s+"&quot;)'>x</button>";
			document.getElementById(s+"input").value='';
			refresh(table);
			refreashdroplist(s);
		}
	}
}
function deletetable(x,s){
	var table = x.parentNode.parentNode.parentNode;
	table.deleteRow(x.parentNode.parentNode.rowIndex);
	refresh(table);
	refreashdroplist(s);
}
function checkkey(e,x){
	e.preventDefault();
	if (e.keyCode == 13){
		document.getElementById(x+"add").click();
	}
	showpage(x);
}
function checkkey2(e,x){
	e.preventDefault();
	if (e.keyCode == 13){
		x.parentNode.innerHTML = x.value;
	}
}
function showpage(x){
	//document.getElementById(x+'listarea').hidden=!document.getElementById(x+'listarea').hidden;
	if (x=='teacher'){
		document.getElementById('teacherlistarea').hidden=false;
		document.getElementById('venuelistarea').hidden=true;
		document.getElementById('sportslistarea').hidden=true;
		document.getElementById('teachingplanlistarea').hidden=true;
	} else if (x=='venue'){
		document.getElementById('teacherlistarea').hidden=true;
		document.getElementById('venuelistarea').hidden=false;
		document.getElementById('sportslistarea').hidden=true;
		document.getElementById('teachingplanlistarea').hidden=true;
	} else if (x=='sports'){
		document.getElementById('teacherlistarea').hidden=true;
		document.getElementById('venuelistarea').hidden=true;
		document.getElementById('sportslistarea').hidden=false;		
		document.getElementById('teachingplanlistarea').hidden=true;
	} else if (x=='teachingplan'){
		document.getElementById('teacherlistarea').hidden=true;
		document.getElementById('venuelistarea').hidden=true;
		document.getElementById('sportslistarea').hidden=true;
		document.getElementById('teachingplanlistarea').hidden=false;
	}
}
</script>
</body>

</html>
